#!/bin/sh
#
# Pre-push hook for skia-rs
# Runs full test suite before allowing pushes
#

set -e

echo "üöÄ Running pre-push checks..."

echo ""
echo "üìù Verifying code formatting..."
if ! cargo fmt --all -- --check; then
    echo ""
    echo "‚ùå Code formatting check failed!"
    echo "   Run 'cargo fmt --all' to fix formatting issues"
    exit 1
fi
echo "‚úÖ Formatting OK"

echo ""
echo "üîé Running Clippy with strict warnings..."
if ! cargo clippy --workspace --all-targets -- -D warnings -D clippy::all; then
    echo ""
    echo "‚ùå Clippy found issues!"
    echo "   Fix the warnings above before pushing"
    exit 1
fi
echo "‚úÖ Clippy OK"

echo ""
echo "üß™ Running test suite..."
if ! cargo test --workspace; then
    echo ""
    echo "‚ùå Tests failed!"
    echo "   Fix failing tests before pushing"
    exit 1
fi
echo "‚úÖ Tests OK"

echo ""
echo "üìö Checking documentation..."
if ! cargo doc --workspace --no-deps 2>&1 | grep -q "warning:"; then
    echo "‚úÖ Documentation OK"
else
    echo "‚ö†Ô∏è  Documentation has warnings (non-blocking)"
fi

echo ""
echo "‚ú® All pre-push checks passed! Pushing..."
